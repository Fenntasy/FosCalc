<!DOCTYPE html manifest="foscalc.appcache">
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="css/main.css" />
    <meta charset="utf-8"/>
</head>
<body>
    <section id="calculator">
        <header id="screen-container">
            <div id="screen">
                <button id="install">
                    Install this awesome app on your homescreen!
                </button>
            </div>
        </header>
        <table>
            <tr>
                <td>
                    <div class="button"><div class="content">MC</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">MR</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">MS</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">M+</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">M-</div></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="button"><div class="content">←</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">CE</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">C</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">+-</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">√</div></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="button"><div class="content">7</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">8</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">9</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">/</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">%</div></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="button"><div class="content">4</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">5</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">6</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">*</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">1/x</div></div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="button"><div class="content">1</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">2</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">3</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">-</div></div>
                </td>
                <td rowspan=2>
                    <div class="button double-height"><div class="content">=</div></div>
                </td>
            </tr>
            <tr>
                <td colspan=2>
                    <div class="button double-width"><div class="content">0</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">.</div></div>
                </td>
                <td>
                    <div class="button"><div class="content">+</div></div>
                </td>
            </tr>
        </table>
    </section>
    <script>
        (function(){
            var buttons = document.getElementsByClassName('button');
            var screen = document.getElementById('screen');
            var calc = '';
            var buttonClicked = function() {
                var item = this.children.item(0).innerHTML;
                switch(item) {
                    case '=':
                        if (calc) {
                            calc = eval(calc);
                        }
                        break;
                    case 'MC':
                    case 'MR':
                    case 'MS':
                    case 'M+':
                    case '←':
                    case 'CE':
                        calc = '';
                    case 'C':
                        calc = calc.substr(0, calc.length - 1);
                    case '+-':
                    case '√':
                    case '%':
                    case '1/x':
                        break;
                    case '/':
                    case '*':
                    case '-':
                    case '+':
                        calc += item;
                        break;
                        break;
                    default:
                        calc += item;
                        break;
                }
                screen.innerHTML = calc;
            }
            for (var i = 0; i < buttons.length; i++) {
                console.log(i);
                buttons[i].addEventListener('click', buttonClicked, false);
            }

            // get a reference to the button and call install() on click
            var button = document.getElementById('install');
            button.addEventListener('click', install, false);

            var request = navigator.mozApps.checkInstalled("http://vincent.billey.me/foscalc/manifest.webapp");
            request.onsuccess = function() {
                if (request.result) {
                    // we're installed
                    button.style.display = "none";
                } else {
                    // not installed
                    button.style.display = "show";
                }
            };
            request.onerror = function() {
                alert('Error checking installation status: ' + this.error.message);
            };

            function install(ev) {
                ev.preventDefault();
                // define the manifest URL
                var manifest_url = "http://vincent.billey.me/foscalc/manifest.webapp";
                // install the app
                var myapp = navigator.mozApps.install(manifest_url);
                myapp.onsuccess = function(data) {
                    // App is installed, remove button
                    this.parentNode.removeChild(this);
                };
                myapp.onerror = function() {
                    // App wasn't installed, info is in
                    // installapp.error.name
                    alert(myapp.error.name);
                };
            };
        })();
    </script>
</body>
</html>